# Рекомендации по конфигурации сервера (Next.js + Directus)

На одном сервере работают:
- **Next.js** (voshod-web) — фронт и API (оформление заказов);
- **Directus** — админка и API каталога;
- **СУБД** для Directus (PostgreSQL/MySQL или SQLite).

---

## Минимальная конфигурация (малый трафик, до ~1–2 тыс. посетителей/мес)

| Ресурс | Рекомендация | Комментарий |
|--------|--------------|-------------|
| **CPU** | 2 vCPU (гарантированных) | 1 vCPU возможно, но при пиках (сборка, регенерация страниц) будет тормозить. Избегайте «10% CPU» — лучше 1 полное ядро. |
| **RAM** | **4 ГБ** | Next.js ~0.5–1 ГБ, Directus ~0.5–1 ГБ, PostgreSQL ~0.5–1 ГБ, система + запас. Впритык, но реально. |
| **Диск** | 20–40 ГБ SSD | Система, Node, приложения, БД, логи. Рекомендуется SSD. |
| **ОС** | Ubuntu 22.04 LTS | Удобно для Node, Nginx, PM2. |

**База Directus:** при 4 ГБ RAM лучше **PostgreSQL** (или MySQL): SQLite под нагрузкой и конкурентными запросами может тормозить. Если трафик совсем маленький — SQLite допустим.

---

## Оптимальная конфигурация (комфортная работа, запас на рост)

| Ресурс | Рекомендация | Комментарий |
|--------|--------------|-------------|
| **CPU** | 2–4 vCPU | Сборка Next.js и фоновые задачи Directus не будут мешать отдаче страниц. |
| **RAM** | **6–8 ГБ** | Next.js 1–1.5 ГБ, Directus 1–1.5 ГБ, PostgreSQL 1–2 ГБ, кэш, система. Без свопа в обычных сценариях. |
| **Диск** | 40–60 ГБ SSD | Запас под логи, бэкапы БД, загрузки файлов в Directus. |
| **ОС** | Ubuntu 22.04 LTS | — |

На такой конфигурации можно включить **Redis** для кэша Directus (по желанию) и не переживать за пики нагрузки.

---

## Софт на сервере

1. **Node.js** — LTS (20.x или 22.x). Установка через `nvm` или официальный репозиторий NodeSource.
2. **PostgreSQL** (или MySQL) — для Directus. SQLite только для теста/минимального трафика.
3. **Nginx** — обратный прокси и (опционально) раздача статики/кэширование.
4. **PM2** — запуск и автоперезапуск Next.js и Directus.
5. **Redis** (опционально) — кэш сессий/данных Directus при 6+ ГБ RAM.

---

## Размещение процессов

- **Next.js:** `next build` + `next start` (порт, например, 3000). Запуск через PM2.
- **Directus:** свой процесс (порт, например, 8055). Запуск через PM2 или через официальный Docker/пакет Directus.
- **PostgreSQL** — localhost, отдельный порт (5432).
- **Nginx** — слушает 80/443, проксирует:
  - `yourdomain.com` → `http://127.0.0.1:3000` (Next.js);
  - `admin.yourdomain.com` (или `/directus`) → `http://127.0.0.1:8055` (Directus).

Так Next и Directus изолированы по портам и по доменам/путям.

---

## Ориентир по провайдерам (VPS)

- **2 vCPU, 4 ГБ RAM** — типичный «минимальный» VPS (Selectel, Timeweb, Reg.ru, Beget VPS и т.п.).
- **2–4 vCPU, 6–8 ГБ RAM** — комфортный вариант для Next + Directus + PostgreSQL.

Итог: для продакшена с Directus на том же сервере разумный минимум — **2 vCPU, 4 ГБ RAM, SSD**, с БД PostgreSQL. Для спокойной работы и запаса — **2–4 vCPU, 6–8 ГБ RAM**.
